{"ast":null,"code":"var _jsxFileName = \"/Users/rut/Documents/WCS Bootcamp/Projects/La Pegatina/LaPegatina/src/Components/Map/Game.js\";\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport '../../App.css';\nimport '../Quiz/Quiz.css';\nimport './Map.css';\nimport '../Home/Button.css';\nimport './../MistakesList.css';\nimport Button from '../Buttons/Button';\nimport Shuffle from '../Utils/Shuffle';\nimport Spotify from '../Utils/Spotify';\nimport PlayerCountdown from '../PlayerCountdown/PlayerCountdown';\nimport Sound from 'react-sound';\n\nclass Game extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.spotifyObject = {};\n    this.spotifyFilteredObjArr = [];\n    this.display = \"\";\n    this.chosenSong = \"\";\n    this.coincidence = false;\n    this.answerCountShow = false;\n    this.unknownSongs = [];\n    this.state = {\n      songNames: [],\n      currentSong: {\n        preview_url: \"\",\n        name: \"\"\n      },\n      hideResults: true,\n      correctAnswers: 0,\n      total: 0,\n      songUrl: \"\",\n      playerState: Sound.status.PLAYING,\n      playing: false,\n      replayingSong: \"\",\n      playlistID: \"37i9dQZF1DZ06evO2EUrsw\"\n    };\n\n    this.getSongsToDisplay = currentSongName => {\n      let allSongsArr = this.spotifyObject.tracks.items.map(function (item) {\n        return item.track.name;\n      });\n      let filteredSongsArr = allSongsArr.filter(function (song) {\n        return song !== currentSongName;\n      });\n      let shuffledFilterSongsArr = Shuffle(filteredSongsArr);\n      let fourNonShuffledSongsArr = shuffledFilterSongsArr.slice(0, 3); // actually 3\n\n      fourNonShuffledSongsArr.push(currentSongName); // now 4\n\n      let fourShuffledSongsArr = Shuffle(fourNonShuffledSongsArr);\n      return fourShuffledSongsArr;\n    };\n\n    this.chooseSongs = () => {\n      this.setState({\n        songNames: this.getSongsToDisplay(this.state.currentSong.name)\n      });\n    };\n\n    this.setNewRandomSong = () => {\n      let randomSong = this.spotifyFilteredObjArr[Math.floor(Math.random() * this.spotifyFilteredObjArr.length)].track;\n      this.setState({\n        currentSong: {\n          preview_url: randomSong.preview_url,\n          name: randomSong.name\n        },\n        songNames: this.getSongsToDisplay(randomSong.name),\n        hideResults: true,\n        total: this.state.total + 1,\n        playerState: Sound.status.STOPPED\n      });\n    };\n\n    this.writeChosenSong = songName => {\n      this.chosenSong = songName;\n    };\n\n    this.checkCoincidence = () => {\n      this.coincidence = this.state.currentSong.name === this.chosenSong;\n\n      if (this.coincidence !== true) {\n        this.unknownSongs.push(this.state.currentSong.name);\n      }\n\n      this.setState({\n        hideResults: false,\n        correctAnswers: this.coincidence ? this.state.correctAnswers + 1 : this.state.correctAnswers\n      });\n    };\n\n    this.showAnswerCount = () => {\n      this.answerCountShow = true;\n    };\n\n    this.getSongUrl = songName => {\n      //allTracksArr is an array made of tracks (each one, in an object,\n      // and as much tracks as songs are in the playlist)\n      let allTracksArr = this.spotifyFilteredObjArr.map(item => {\n        return item.track;\n      }); //trackArr is an array with an only index which is an object with 2 properties: name and preview_url\n\n      let oneTrackArr = allTracksArr.filter(track => {\n        //Returns an array with the (only) object that fulfills this condition \n        return track.name === songName;\n      });\n      let songUrl = oneTrackArr[0].preview_url;\n      this.setState({\n        songUrl: songUrl,\n        playerState: Sound.status.PLAYING,\n        playing: true,\n        replayingSong: songName // return this.spotifyObject.tracks.items.filter(item => item.track.name === songName)[0].preview_url \n        // This does the same as getSongUrl but with much less lines\n\n      });\n    };\n\n    this.stopMusic = () => {\n      this.setState({\n        playerState: Sound.status.STOPPED,\n        playing: false\n      });\n    };\n\n    this.filterRightSongsFromSpotifyObject = spotifyObject => {\n      this.spotifyFilteredObjArr = this.spotifyObject.tracks.items.filter(function (item) {\n        return item.track.preview_url !== null;\n      });\n    };\n\n    this.setPlayingToFalse = () => {\n      this.setState({\n        playing: false\n      });\n    };\n  }\n\n  /**\n   * This fn returns an array with 4 song names randomly including the current song \n   * @param {string} currentSong - name of the current song playing\n   * @returns {array} songsToDisplay\n  */\n  //API call to get the playlist data.\n  async componentDidMount() {\n    this.spotifyObject = await Spotify.getPlaylist(this.state.playlistID);\n    this.filterRightSongsFromSpotifyObject();\n  }\n\n  //since we're probably only play with one playlist we might not need the following method\n  //BUT: it could be useful for the next stages (playing with different levels/prices)\n\n  /* componentDidUpdate  = async  (prevProps, prevState) => {\n     if (prevState.clave !== this.state.clave) {\n         \n       this.spotifyObject = await Spotify.getPlaylist(this.state.playlistID)\n       this.filterRightSongsFromSpotifyObject();\n     }\n   } \n    show = (event) => {\n      let newList = event.target.className; \n      this.setState({\n  \n       clave: newList,\n      })\n   }*/\n  render() {\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"show\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"QuestionAndAnswers\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"Countdown\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(PlayerCountdown, {\n      onMusicPlays: this.chooseSongs,\n      setNewRandomSong: this.setNewRandomSong,\n      songURL: this.state.currentSong.preview_url,\n      coincidence: this.checkCoincidence,\n      showAnswerCount: this.showAnswerCount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"FourButtons \" + (this.state.hideResults ? 'forceGrayColor' : \"\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }, this.state.songNames.map(songName => {\n      return React.createElement(Button, {\n        key: songName,\n        printedSong: songName //We write it like this so the function writeChoosenSong isn't executed when the button is rendered but when the button \n        //is clicked. Different than what we're doing some lines above in the onMusicPlays, setNewRandomSong or songURL\n        ,\n        onClick: () => this.writeChosenSong(songName),\n        currentSong: this.state.currentSong.name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      });\n    })), React.createElement(\"div\", {\n      id: \"counter\",\n      className: \"instruct\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: this.answerCountShow ? \"show\" : \"hide\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, \"Right answers: \", this.state.correctAnswers, \"  out of \", this.state.total)), React.createElement(\"div\", {\n      className: this.unknownSongs.length > 0 ? \"show\" : \"hide\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      className: \"instruct\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }, \"Learn from your mistakes\"), React.createElement(\"ul\", {\n      id: \"mistakes\",\n      className: \"instruct\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, this.unknownSongs.map(song => {\n      return React.createElement(\"div\", {\n        className: \"list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(\"li\", {\n        className: \"mistake\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, song, React.createElement(\"button\", {\n        className: \"repeat-button\",\n        onClick: this.state.playing ? () => this.stopMusic() : () => this.getSongUrl(song),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, this.state.playing ? \"Pause\" : \"Listen again\")));\n    })), React.createElement(Sound, {\n      url: this.state.songUrl,\n      playStatus: this.state.playerState,\n      autoLoad: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    })))), React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, React.createElement(Link, {\n      className: \"link\",\n      to: \"/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, \"Volver\")));\n  }\n\n}\n\nexport default Game;","map":{"version":3,"sources":["/Users/rut/Documents/WCS Bootcamp/Projects/La Pegatina/LaPegatina/src/Components/Map/Game.js"],"names":["React","Link","Button","Shuffle","Spotify","PlayerCountdown","Sound","Game","Component","spotifyObject","spotifyFilteredObjArr","display","chosenSong","coincidence","answerCountShow","unknownSongs","state","songNames","currentSong","preview_url","name","hideResults","correctAnswers","total","songUrl","playerState","status","PLAYING","playing","replayingSong","playlistID","getSongsToDisplay","currentSongName","allSongsArr","tracks","items","map","item","track","filteredSongsArr","filter","song","shuffledFilterSongsArr","fourNonShuffledSongsArr","slice","push","fourShuffledSongsArr","chooseSongs","setState","setNewRandomSong","randomSong","Math","floor","random","length","STOPPED","writeChosenSong","songName","checkCoincidence","showAnswerCount","getSongUrl","allTracksArr","oneTrackArr","stopMusic","filterRightSongsFromSpotifyObject","setPlayingToFalse","componentDidMount","getPlaylist","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {Link} from 'react-router-dom';\nimport '../../App.css';\nimport '../Quiz/Quiz.css';\nimport './Map.css';\nimport '../Home/Button.css';\nimport './../MistakesList.css';\nimport Button from '../Buttons/Button';\nimport Shuffle from '../Utils/Shuffle';\nimport Spotify from '../Utils/Spotify';\nimport PlayerCountdown from '../PlayerCountdown/PlayerCountdown';\nimport Sound from 'react-sound';\n\n\nclass Game extends React.Component {\n\n  // We have the object coming from the API call, here\n  spotifyObject = {}; \n  //This array contains the songs coming from the spotifyObject that DO ave a preview_url\n  spotifyFilteredObjArr = []; \n  //Here the actual game mechanics start\n  display = \"\";\n  chosenSong = \"\";\n  coincidence = false;\n  answerCountShow= false;\n  //All the songs that the user guessed wrong are pushed into this array\n  unknownSongs= []; \n\n  state = {\n \n    songNames:[],\n    currentSong: {\n        preview_url: \"\",\n        name: \"\",\n    },  \n\n    hideResults: true,\n    correctAnswers: 0,\n    total: 0,\n    songUrl: \"\",\n    playerState: Sound.status.PLAYING,\n    playing: false,\n    replayingSong: \"\",\n\n    playlistID: \"37i9dQZF1DZ06evO2EUrsw\",\n  }\n  /**\n   * This fn returns an array with 4 song names randomly including the current song \n   * @param {string} currentSong - name of the current song playing\n   * @returns {array} songsToDisplay\n  */\n\n  //API call to get the playlist data.\n\n async componentDidMount() {   \n\n  this.spotifyObject = await Spotify.getPlaylist(this.state.playlistID);\n  this.filterRightSongsFromSpotifyObject();\n}\n\n  getSongsToDisplay = (currentSongName) => {\n\n      let allSongsArr = this.spotifyObject.tracks.items.map(function (item){\n      return item.track.name;\n    });\n    \n    let filteredSongsArr = allSongsArr.filter(function (song) {\n\n      return song !== currentSongName;\n    });\n\n    let shuffledFilterSongsArr = Shuffle(filteredSongsArr);\n\n    let fourNonShuffledSongsArr = shuffledFilterSongsArr.slice(0, 3); // actually 3\n    fourNonShuffledSongsArr.push(currentSongName); // now 4\n    \n    let fourShuffledSongsArr = Shuffle(fourNonShuffledSongsArr)\n\n    return fourShuffledSongsArr;\n  }\n\n  chooseSongs = () => {\n    this.setState({\n      songNames: this.getSongsToDisplay(this.state.currentSong.name)\n    })\n  }\n\n  setNewRandomSong = () => {\n    let randomSong = this.spotifyFilteredObjArr[Math.floor(Math.random()*this.spotifyFilteredObjArr.length)].track;\n\n    this.setState({\n      currentSong: {\n        preview_url: randomSong.preview_url,\n        name: randomSong.name\n      },\n      songNames: this.getSongsToDisplay(randomSong.name),\n      hideResults: true,\n      total: this.state.total +1,\n      playerState: Sound.status.STOPPED\n    });\n  }\n  \n  writeChosenSong = (songName) => {\n    this.chosenSong = songName;\n  }\n  \n  checkCoincidence = () => {  \n    this.coincidence = this.state.currentSong.name === this.chosenSong\n\n    if (this.coincidence !== true) { \n      this.unknownSongs.push(this.state.currentSong.name)\n    }\n\n    this.setState({\n      hideResults: false,\n      correctAnswers: this.coincidence ? (this.state.correctAnswers +1) : this.state.correctAnswers\n    })\n  }\n  \n  showAnswerCount = () => {\n    this.answerCountShow= true;\n  }\n  \n  getSongUrl = (songName) => {\n    \n       //allTracksArr is an array made of tracks (each one, in an object,\n      // and as much tracks as songs are in the playlist)\n      let allTracksArr = this.spotifyFilteredObjArr.map((item) => { \n      \n          return item.track;\n      })\n\n      //trackArr is an array with an only index which is an object with 2 properties: name and preview_url\n      \n      let oneTrackArr = allTracksArr.filter((track) => { \n\n        //Returns an array with the (only) object that fulfills this condition \n          return track.name === songName \n      })\n\n      let songUrl = oneTrackArr[0].preview_url;\n\n      this.setState({\n          songUrl: songUrl,\n          playerState: Sound.status.PLAYING,\n          playing: true,\n          replayingSong: songName\n          // return this.spotifyObject.tracks.items.filter(item => item.track.name === songName)[0].preview_url \n          // This does the same as getSongUrl but with much less lines\n      }) \n  }\n  \n  stopMusic = () => {\n    this.setState({\n      playerState: Sound.status.STOPPED,\n      playing: false\n    })\n  }\n  \n  filterRightSongsFromSpotifyObject = (spotifyObject) => {\n    this.spotifyFilteredObjArr = this.spotifyObject.tracks.items.filter(function (item) {\n    return item.track.preview_url !== null})\n  }\n  \n  setPlayingToFalse = () => {\n      this.setState({\n          playing: false\n      })\n  }\n  \n  //since we're probably only play with one playlist we might not need the following method\n  //BUT: it could be useful for the next stages (playing with different levels/prices)\n            \n /* componentDidUpdate  = async  (prevProps, prevState) => {\n    if (prevState.clave !== this.state.clave) {\n        \n      this.spotifyObject = await Spotify.getPlaylist(this.state.playlistID)\n      this.filterRightSongsFromSpotifyObject();\n    }\n  } \n\n  show = (event) => {\n\n    let newList = event.target.className; \n\n    this.setState({\n \n      clave: newList,\n\n    })\n  }*/\n\n  render() {\n    return (\n      <section>\n        <div className=\"show\"> \n          <div className=\"QuestionAndAnswers\">\n            <div className=\"Countdown\">\n              <PlayerCountdown\n                onMusicPlays={this.chooseSongs}\n                setNewRandomSong={this.setNewRandomSong}\n                songURL={this.state.currentSong.preview_url} \n                coincidence={this.checkCoincidence}\n                showAnswerCount={this.showAnswerCount}\n              />\n            </div>\n            <div className={\"FourButtons \" + (this.state.hideResults ? 'forceGrayColor' : \"\")} >\n              {this.state.songNames.map((songName) => {\n                return (\n                  <Button \n                    key={songName} \n                    printedSong={songName} \n                    //We write it like this so the function writeChoosenSong isn't executed when the button is rendered but when the button \n                    //is clicked. Different than what we're doing some lines above in the onMusicPlays, setNewRandomSong or songURL\n                    onClick={() => this.writeChosenSong(songName)}\n                    currentSong={this.state.currentSong.name}\n                  />\n                )\n              })}\n            </div>\n            <div id=\"counter\" className=\"instruct\">\n              <p className={this.answerCountShow ? \"show\" : \"hide\"}>Right answers: {this.state.correctAnswers}  out of {this.state.total}</p>\n            </div>\n            <div className={this.unknownSongs.length > 0 ? \"show\" : \"hide\"}>\n                <h4 className=\"instruct\">Learn from your mistakes</h4>\n                <ul id=\"mistakes\" className=\"instruct\">  \n                  {this.unknownSongs.map((song) => {\n                    return (\n                      <div className=\"list\">\n                        <li className=\"mistake\">{song} \n                          <button className=\"repeat-button\" onClick={this.state.playing ? () => this.stopMusic() : () => this.getSongUrl(song)}>\n                            {this.state.playing ? \"Pause\" : \"Listen again\"} \n                          {/* We write it with an arrow function instead of a 'normal' function so we can avoid an infinite loop \n                          when setting the state */}  \n                          </button> \n                        </li>\n                      </div>\n                    )\n                  })}\n                </ul>\n                <Sound \n                  url={this.state.songUrl}\n                  playStatus={this.state.playerState}\n                  autoLoad\n                />\n            </div>\n          </div>\n          </div>\n        \n          <h3><Link className=\"link\" to=\"/\">Volver</Link></h3>   \n\n            {\n            //ALSO: intermediate button, before getting to the game needs to be removed\"\n            }\n      </section>\n    );\n  }\n}\n\nexport default Game;\n\n\n"]},"metadata":{},"sourceType":"module"}